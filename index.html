<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sumo Pick'em</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header>
    <h1>Sumo Pick'em</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/profile">My Profile</a>
      <a href="/logout">Logout</a>
    </nav>
  </header>

  <main>
    <section class="matchups" id="matchupsContainer">
      <!-- Matchups will be populated here -->
    </section>
    <button id="submitPicks">Submit Picks</button>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const matchupsContainer = document.getElementById("matchupsContainer");
      const submitButton = document.getElementById("submitPicks");

      fetch("/data")
        .then((res) => res.json())
        .then((data) => {
          const matchData = data.matchups;
          const rikishiData = data.rikishiData;

          matchData.forEach((match, index) => {
            const matchupDiv = document.createElement("div");
            matchupDiv.classList.add("matchup");

            const matchId = `match-${index}`;
            const east = rikishiData[match.east];
            const west = rikishiData[match.west];

            matchupDiv.innerHTML = `
              <div class="rikishi">
                <span class="rikishi-a">
                  ${east ? `<a href="${east.url}" target="_blank">${east.shikona}</a>` : match.east}
                </span>
                <div class="radio-group">
                  <label>
                    <input type="radio" name="${matchId}" value="${match.east}">
                    Win
                  </label>
                </div>
              </div>
              <div class="vs">vs</div>
              <div class="rikishi">
                <span class="rikishi-b">
                  ${west ? `<a href="${west.url}" target="_blank">${west.shikona}</a>` : match.west}
                </span>
                <div class="radio-group">
                  <label>
                    <input type="radio" name="${matchId}" value="${match.west}">
                    Win
                  </label>
                </div>
              </div>
            `;

            matchupsContainer.appendChild(matchupDiv);
          });
        });

      submitButton.addEventListener("click", () => {
        const picks = [];
        const radios = document.querySelectorAll("input[type='radio']:checked");

        radios.forEach((radio) => {
          const matchId = radio.name;
          const index = parseInt(matchId.split("-")[1]);
          const matchElement = document.querySelectorAll(".matchup")[index];
          const rikishiA = matchElement.querySelector(".rikishi-a").textContent.trim();
          const rikishiB = matchElement.querySelector(".rikishi-b").textContent.trim();
          
          picks.push({
            match: `${rikishiA} vs ${rikishiB}`,
            userPick: radio.value,
            correctPick: null,
          });
        });

        localStorage.setItem("userPicks", JSON.stringify(picks));
        alert("Your picks have been submitted!");
      });
    });
  </script>
</body>
</html>
